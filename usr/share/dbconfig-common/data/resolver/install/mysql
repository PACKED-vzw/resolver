CREATE TABLE IF NOT EXISTS `ImportLog` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `import_id` varchar(64) DEFAULT NULL,
  `user` varchar(32) DEFAULT NULL,
  `timestamp` datetime DEFAULT NULL,
  `data` text,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `entity` (
  `id` varchar(64) NOT NULL,
  `original_id` varchar(64) DEFAULT NULL,
  `type` enum('work','agent','concept','event') DEFAULT NULL,
  `title` varchar(512) DEFAULT NULL,
  `slug` varchar(64) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `document` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `entity_id` varchar(64) DEFAULT NULL,
  `enabled` tinyint(1) DEFAULT NULL,
  `notes` text,
  `url` varchar(512) DEFAULT NULL,
  `type` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `entity_id` (`entity_id`),
  CONSTRAINT `document_ibfk_1` FOREIGN KEY (`entity_id`) REFERENCES `entity` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `data` (
  `id` int(11) NOT NULL,
  `format` enum('html','json','xml','pdf') DEFAULT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `data_ibfk_1` FOREIGN KEY (`id`) REFERENCES `document` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `documenthit` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `ip` varchar(15) DEFAULT NULL,
  `document_id` int(11) DEFAULT NULL,
  `referrer` varchar(128) DEFAULT NULL,
  `timestamp` datetime DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `document_id` (`document_id`),
  CONSTRAINT `documenthit_ibfk_1` FOREIGN KEY (`document_id`) REFERENCES `document` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `kvpair` (
  `key` varchar(64) NOT NULL,
  `value` text,
  PRIMARY KEY (`key`)
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TEMPORARY TABLE `kvpair_f` (
    `key` varchar(64) NOT NULL,
    `value` text
) ENGINE=InnoDB DEFAULT CHARSET=latin1;
INSERT INTO `kvpair_f` VALUES ('default_notice','S\'\'\n.'),('default_notice_clean','S\'\'\n.'),('domains','S\'\'\n.'),('logo_url','S\'\'\n.'),('titles_enabled','I01\n.');

INSERT INTO `kvpair`
SELECT f.key, f.value FROM `kvpair_f` f
WHERE NOT EXISTS (SELECT * FROM `kvpair`);

DROP TABLE `kvpair_f`;


CREATE TABLE IF NOT EXISTS `log` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `entity` varchar(64) DEFAULT NULL,
  `user` varchar(32) DEFAULT NULL,
  `timestamp` datetime DEFAULT NULL,
  `data` text,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `representation` (
  `id` int(11) NOT NULL,
  `order` int(11) DEFAULT NULL,
  `reference` tinyint(1) DEFAULT NULL,
  `label` varchar(64) DEFAULT NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `representation_ibfk_1` FOREIGN KEY (`id`) REFERENCES `document` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

CREATE TABLE IF NOT EXISTS `user` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `username` varchar(32) DEFAULT NULL,
  `password` varchar(64) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=latin1;
INSERT INTO `user` (`username`, `password`)
SELECT 'admin', '5c52ae919796c37b531b6ad8bfb194574376c741b49ddaeef394568b3c19ebf5' FROM DUAL
WHERE NOT EXISTS (SELECT * FROM `user`);
